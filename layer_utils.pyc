import os
from PIL import Image
import numpy as np


RESHAPE = (256,256)

def is_an_image_file(filename):
    IMAGE_EXTENSIONS = ['.png', '.jpg', '.jpeg']
    for ext in IMAGE_EXTENSIONS:
        if ext in filename:
            return True
    return False


def list_image_files(directory):
    files = os.listdir(directory)
    return [os.path.join(directory, f) for f in files if is_an_image_file(f)]


def load_image(path):
    img = Image.open(path)
    return img
def preprocess_image(cv_img):
    cv_img = cv_img.resize(RESHAPE)
    img = np.array(cv_img)
    img = (img - 127.5) / 127.5
    return img


def deprocess_image(img):
    img = img * 127.5 + 127.5
    return img.astype('uint8')


def save_image(np_arr, path):
    img = np_arr * 127.5 + 127.5
    im = Image.fromarray(img)
    im.save(path)


def load_images(start, batchsize):
    if start>(25000-batchsize):
        end=25000
    else:
        end=start+batchsize

    images_A, images_B = [], []
    images_A_paths, images_B_paths = [], []
    i=start
    for i in range(end):
        path_A='images/A/T'+str(i)+'.jpg'
        path_B='images/B/L'+str(i)+'.jpg'
        img_A, img_B = load_image(path_A), load_image(path_B)
        #print('image laoded')
        images_A.append(preprocess_image(img_A))
        images_B.append(preprocess_image(img_B))
        images_A_paths.append(path_A)
        images_B_paths.append(path_B)
        #print('image stacked')
    print('Data Loaded')
    return {
        'A': np.array(images_A),
        'A_paths': np.array(images_A_paths),
        'B': np.array(images_B),
        'B_paths': np.array(images_B_paths)
    }
if __name__ == '__main__':
    load_images(0,128)
